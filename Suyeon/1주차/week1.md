## 💡 운영체제란 무엇인가? (= OS)

- 컴퓨터 시스템의 핵심 **소프트웨어**
- 일반적으로 하드웨어를 관리하고, `응용 프로그램과 하드웨어 사이에서 인터페이스` 역할을 하며, 시스템의 동작을 제어하는 시스템 소프트웨어이다.
- 시스템 자원을 효율적으로 관리하여 응용 프로그램이 원활하게 동작할 수 있도록 한다.
- OS의 핵심 부분은 `커널(Kernel)`이라고 부르는데 이 커널에 라이브러리, 시스템 프로그래밍 등이 추가된 상태를 통칭해서 운영체제라고 한다.
- 윈도우, macOs, 리눅스, 유닉스 등이 있다


**운영체제의 목적**

1. 처리능력 향상
2. 반환시간 단축
3. 사용가능도 향상
4. 신뢰도 향상

→ 위 4가지 기준에 적합한 정도가 운영체제의 성능을 평가하는 척도가 된다.

- 처리능력(Throughput)
    - 일정 시간 내에 시스템이 처리하는 일의 양
- 반환시간(Turn Around Time)
    - 시스템에 작업을 의뢰한 시간부터 처리가 완료될 때까지 걸린 시간
- 사용가능도(Availability)
    - 시스템을 사용할 필요가 있을 때 즉시 사용 가능한 정도
- 신뢰도(Reliabilty)
    - 시스템이 주어진 문제를 정확하게 해결하는 정도
 
      
<img width="394" alt="스크린샷 2023-12-21 오전 9 58 45" src="https://github.com/CS-Entrance/Chapter1/assets/89267864/d517b8f0-3583-48d1-87f2-674bd83628e8">



## 💡 프로세스와 스레드에 대해 설명해주세요.

**프로세스**

- 운영체제로부터 자원을 할당받는 작업의 단위
    - 프로세스는 실행될 때 운영체제로 부터 “프로세서, 필요한 주소 공간, 메모리”등의 자원을 할당받는다.

**스레드**

- 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위
    - 스레드는 한 프로세스 내에서 동작되는 여러 실행의 흐름
    - 프로세스 내의 주소 공간이나 자원들을 같은 프로세스 내 스레드끼리 공유하면서 실행된다

여러 프로세스로 작업을 하지 않고 하나의 프로세스에서 스레드로 나눠 작업하는 이유가 무엇인가?

즉, 운영체제는 시스템 자원을 효율적으로 관리하기 위해 스레드를 사용하는 것이다.

<img width="699" alt="스크린샷 2023-12-21 오전 9 59 06" src="https://github.com/CS-Entrance/Chapter1/assets/89267864/965b1c58-1c75-43ac-8d84-b320a02ee84d">

⇒ 멀티 프로세스 vs 멀티 스레드

멀티 프로세스의 경우 프로세스 간 통신 비용이 들지만 멀티 스레드는 프로세스를 공유할 수 있으므로 작업간 통신 부담이 줄어들게 된다.

스레드를 활용하면 자원의 효율성이 증가하지만 이런 자원 공유는 전역 변수를 이용하기 때문에 “동기화”문제에 신경을 써야 한다.

더 자세한 내용은 아래 후술한다.

**🍀 질문의 핵심**

운영체제에서 작업을 실행할 때 자원을 할당하는 단위를 알고있느냐
프로그램을 멀티 스레드로 구현할 때 장단점을 알고 있느냐


## 💡 멀티 스레드의 장점 및 단점은 무엇인가?
<img width="440" alt="스크린샷 2023-12-21 오전 9 59 51" src="https://github.com/CS-Entrance/Chapter1/assets/89267864/a638a40a-7a1d-4dec-85cb-4678264f4e6c">

### **장점**

1️⃣ 자원의 효율성

- 하나의 프로세스 내에서 여러개 생성되기 때문에 공유 메모리에 대해 스레드간 자원 공유가 가능하다

2️⃣ Context Switching 비용 감소

- 스레드에도 컨텍스트 스위칭 오버헤드가 존재하지만 프로세스 컨텍스트 스위칭 오버헤드보다 훨씬 낮아 비용이 낮다
- 스레드 컨텍스트 스위칭은 스레드 간에 공유하는 자원을 제외한 스레드 정보(stack, register)만 교체하면 되므로 프로세스 컨텍스트 스위칭 비용보다 상대적으로 비용이 낮다
    - 프로세스 컨텍스 스위칭은 CPU 캐시 내용을 초기화하고 새로운 프로세스 정보를 다시 적재해야 하므로 높은 비용이 든다

3️⃣ 응답 시간 단축

- 자원 공유가 용이해 효율성이 좋으며 가벼워 컨텍스트 스위칭 비용도 작다 
⇒ 오버헤드가 적다 
⇒ 응답시간이 빠르다

4️⃣ 프로세스보다 가벼운 용량

- 스레드는 프로세스 내에서 생성되기 때문에 설정 작업이 간단하여 생성과 종료가 빠르다
- code, data, stack 영역을 제외한 나머지 자원을 공유하기 때문에 데이터 용량이 적다

### **단점**

1️⃣ 안정성 문제

- 스레드끼리 독립적이지 않으므로 하나의 스레드에서 문제가 발생하면 다른 스레드가 영향을 받아 프로그램이 종료될 수 있는 문제가 있다.

2️⃣ 동기화로 인한 성능 저하

- 여러 개의 스레드가 공유 자원에 동시에 접근할 때 “동시성 문제”가 발생할 수 있다
- 따라서 이를 해결하기 위해 스레드간 “동기화”가 필수적이다
- “동기화”작업은 여러 스레드들이 자원에 접근하는 순서를 순차적으로 관리하는 작업이다 
⇒ 병목현상 발생
⇒ 성능저하
- 이를 해결하기 위해 임계 영역에 대해 Mutex, Semaphore 방식을 활용할 수 있다.


> 임계영역(Critical Section)
> 
멀티 스레드 프로그래밍의 임계영역 - 공유 자원을 접근하는 코드 영역, 전역 변수나 Heap 메모리 영역등

> 뮤텍스(Mutex)
> 
임계 영역에 진입하기 전 Lock을 획득하고 임계 영역을 빠져나올 때 Lock을 해제하여 다른 스레드들이 접근하도록 한다
즉, 오직 1개의 스레드만이 공유 자원에 접근할 수 있도록 제어하는 기법이다.

> 세마포어(Semaphore)
> 
공유 자원에 동시에 접근 가능한 스레드의 갯수를 지정할 수 있는 기법이다.

세마포어 값이 1인 경우 뮤텍스와 동일한 역할이다. 즉, 값이 2 이상인 경우 동시에 접근할 스레드 갯수를 제어할 수 있다.

스레드가 임계 영역에 진입하기 전에 세마포어 값을 확인하고 값이 허용된 범위인 경우만 Lock을 획득할 수 있다.

3️⃣ 데드락 (DeadLock, 교착 상태)

- 스레드 간 “동기화”를 위해 공유 자원에 락이 걸려있는데 여러 개의 스레드가 공유 자원에 접근하기 위해 대기하면서 무한정 기다리게 되는 현상이 발생할 수 있다
- 멀티 스레드만의 단점이라기 보단 멀티 프로세스와 공통된 문제점이다
- 이를 해결하기 위해선 상호배제(Mutual Exclustion), 점유와 대기(Hold and Wait), 비선점(No Preemption), 순환 대기(Circular Wait)등 알고리즘을 통해 해결할 수 있다

4️⃣ Context Swtiching Overhead ⭐⭐⭐

- 프로세스 컨텍스트 스위칭보다 작은 비용이지만 스레드 컨텍스트 스위칭도 비용디 든다
- 스레드가 많아질수록 항상 성능이 좋아진다에 대해 대답을 할 수 있는 항목이다 ⇒ 정답은 “**아니다**”
- 동시성 처리해야 할 스레드가 많아지기도 하고 스레드간 컨텍스트 스위칭이 발생하면서 성능이 저하될 수 있기 때문이다.

<img width="653" alt="스크린샷 2023-12-21 오전 10 00 21" src="https://github.com/CS-Entrance/Chapter1/assets/89267864/3a8429d7-d0f9-489e-920f-ba95c35d1082">


멀티 프로세스 vs 멀티 스레드

- 스레드는 자원을 공유하기 때문에 `Context Switch가 적고 오버헤드가 작습니다.`
- 단점은 프로세스 내부의 자원을 공유하기 때문에 `동시에 자원에 접근했을 때 문제`가 될 수 있습니다. 또한, 하나의 스레드가 자신의 데이터 공간을 망가뜨린다면 해당 데이터를 공유하고 있는 모든 스레드에 치명적인 문제를 발생시킵니다.

## 💡 멀티 프로세스 대신 멀티 스레드를 사용하는 이유


🍀 **멀티 프로세스 vs 멀티 프로세서**
<img width="740" alt="스크린샷 2023-12-21 오전 10 00 51" src="https://github.com/CS-Entrance/Chapter1/assets/89267864/96082049-5de0-46f0-ac36-725e9c365b74">



**멀티 프로세스의 단점**

- 1️⃣ Context Switching 과정에서 성능 저하
    - 프로세스를 스위칭하기 위해선 메모리를 검색, CPU 캐시 메모리 초기화, 프로세스 상태 저장, 불러올 데이터 준비등 작업이 굉장히 많다
    - 따라서 프로세스를 자주 context swtiching하게 된다면 오버헤드가 발생한다.
    - 반면 스레드를 context swtiching 한다면 프로세스 스위칭보다 가벼워 빠르다
        
        ⇒ 그래서 멀티 스레드 사용
        
- 2️⃣ 자원 공유 비효율성
    - 멀티 프로세스는 각 프로세스가 독립적인 메모리 공간을 가진다 ⇒ 메모리 사용량 증가
    - 프로세스간 자원 공유를 위해선 복잡한 IPC 기법을 사용해야 한다 ⇒ 오버헤드 발생
    - 반면 스레드는 하나의 프로세스 내에서 여러 개의 스레드로 작업하기 때문에 공유 메모리로 특별한 기법없이 스레드간 자원 공유가 가능하다.
        <img width="660" alt="스크린샷 2023-12-21 오전 10 04 11" src="https://github.com/CS-Entrance/Chapter1/assets/89267864/8fd90582-151e-4f6e-a234-5b97986c2ca0">        
        - 이로인해 자원의 효율적 사용, 시스템 자원 소모 감소가 가능하다
        
        ⇒ 그래서 멀티 스레드 사용
        

• 프로그램을 여러 개 키는 것보다 하나의 프로그램 안에서 여러 작업을 해결하기 위해서 입니다. 이유는 `프로세스를 생성하여 자원을 할당하는 시스템 콜`이 줄어 들어 자원을 효율적으로 관리할 수 있습니다. 또한 프로세스간의 통신보다 쓰레드 간의 `통신의 비용`이 적기 때문에 멀티 프로세스보다 멀티 스레드를 사용하는 이유입니다.

## 💡 스레드에 스택을 독립적으로 할당하는 이유?

스택은 함수 호출을 위한 메모리 공간

스택 공간이 독립적이라는 것은 함수 호출을 독립적으로 하기 위함이다

즉, 스레드간 함수 호출이 독립적인 흐름으로 이루어 지도록 하기 위함이다.

이렇게 되면 스레드간에 간섭없이 동시에 여러 작업을 처리할 수 있게 되어 프로그램 성능이 향상된다.

그리고 여러 작업을 처리하기 위해 아래의 pc register를 각 스레드에 할당하게 되는 것이다.

**🍀 스택(Stack)**

함수 호출 시 전달되는 `인자`, 작업 후 돌아갈 `주소값`, 함수 내의 `변수`등을 저장하는 메모리 공간 
    

## 💡 PC 레지스터를 스레드마다 독립적으로 할당하는 이유?

pc register란 스레드가 어느 명령어까지 수행했는지 나타내기 위해 존재한다

여기서 pc의 의미는 program counter이다.

여러 스레드가 동시에 실행될 수 있으므로 각 스레드간 pc register를 통해 명령어를 구분하여 스레드를 병렬 실행시킬 수 있다

스레드간 컨텍스트 스위칭이 이루어질 때 해당 스레드가 어느 명령어까지 수행했는지 기억하기 위해 스레드마다 pc register를 할당한다.

이를 통해 스레드로 병렬 작업을 수행할 수 있고 프로그램의 성능을 향상시킬 수 있다

    
